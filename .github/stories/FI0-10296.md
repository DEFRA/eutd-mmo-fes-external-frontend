# User Story

As an exporter

I need to see a summary of my processed products

So that I can review and decide if I need to add more

## Technical Implementation

### Frontend (mmo-fes-external-fe)

- **Route**: `/create-processing-statement/:documentNumber/remove-product/:productId`
- **Function**: `removeProcessingStatementProduct` in `app/.server/processingStatement.ts`
  - Filters out product with matching `productId` from `products[]` array
  - Filters out all catches with matching `productId` from `catches[]` array
  - Sends updated ProcessingStatement payload to orchestration service

### Backend (mmo-fes-orchestration)

- **Validation Handler**: `/create-processing-statement/:documentNumber/remove-product/:productId` in `src/services/handlers/processing-statement.ts`
  - Validates the updated payload (filtered arrays from frontend)
  - Returns empty errors (validation passes)
- **Persistence**: Orchestration service persists the updated document via `addProcessingDetails`
- **Progress Calculation**: Backend automatically recalculates progress status when products array is empty

## Acceptance Criteria

## Scenario 1 - Remove product page exists

Given I have navigated to /remove-product in my Processing Statement user journey

When the page loads

Then the page title is 'Remove a product'

And there is a question of 'Do you want to remove 'product description' and all its associated species?' where 'product description' is the product description of the product that the user has pressed 'Remove product' against

And the answers are 'Yes' and 'No' as radio buttons side by side

And there is a 'Back' link at the top of the page

And there are 2 buttons at the bottom of the page 'Save as draft' and 'Save and continue' ('Save as draft' on left, 'Save and continue' on right)

And there is a 'Back to your progress' link below the buttons

## Scenario 2 - Yes + Save and continue + other products remaining

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected 'Yes'

And I press 'Save and continue'

And there are other products on the application

Then the product and all associated species are removed from the application (filtered by frontend, persisted by backend)

And I am navigated back to /catch-added

## Scenario 3 - Yes + Save and continue + no other products remaining

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected 'Yes'

And I press 'Save and continue'

And there are no other products

Then the product and all associated species are removed from the application (filtered by frontend, persisted by backend)

And I am navigated to /add-consignment-details

And the section 'Processed product details' in 'Your Progress' is marked as 'Incomplete' (handled by backend progress calculation)

## Scenario 4 - Yes + Save as draft

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected 'Yes'

And I press 'Save as draft'

Then the product and all associated species remain on the application

And I am navigated to /progress

## Scenario 5 - No + Save and continue

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected 'No'

And I press 'Save and continue'

Then the product and all associated species remain on the application

And I am navigated back to /catch-added

## Scenario 6 - No + Save as draft

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected 'No'

And I press 'Save as draft'

Then the product and all associated species remain on the application

And I am navigated to /progress

## Scenario 7 - Welsh translations

Given I have navigated to /remove-product in my Processing Statement user journey

When I have selected Welsh language

Then all text is translated to Welsh

| English text                                                                | Welsh translation                                                              |
| --------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| Remove a product                                                            | Tynnwch gynnyrch                                                               |
| Do you want to remove 'product description' and all its associated species? | Hoffech chi dynnu 'disgrifiad o'r cynnyrch' a'r holl rywogaethau cysylltiedig? |
| Yes                                                                         | Ydw                                                                            |
| No                                                                          | Nac ydw                                                                        |

## Scenario 8 - Changes reflected when navigating from Admin app

Given I have accessed the processing statement journey via the Admin app

When I have navigated to /remove-product in my Processing Statement user journey

Then the changes mentioned in scenario 1 - scenario 7 are present

## Scenario 9 - Non-JS

Given I have navigated to /remove-product in my Processing Statement user journey

And javascript is turned off

Then all the page must be compliant with non javascript

## Scenario 10 - Accessibility

Given I have navigated to /remove-product in my Processing Statement user journey

Then the page must be compliant with GDS accessibility guidelines
